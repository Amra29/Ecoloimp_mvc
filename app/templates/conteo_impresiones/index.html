{% extends "conteo_impresiones/base.html" %}

{% block page_title %}Conteo de Impresiones{% endblock %}

{% block card_title %}
    <i class="fas fa-print me-2"></i>Registro de Conteos de Impresiones
{% endblock %}

{% block card_actions %}
    <a href="{{ url_for('conteos.nuevo') }}" class="btn btn-primary btn-sm">
        <i class="fas fa-plus me-1"></i> Nuevo Conteo
    </a>
{% endblock %}

{% block card_content %}
<div class="table-responsive">
    <table class="table table-striped table-hover" id="dataTable" width="100%" cellspacing="0">
        <thead class="table-dark">
            <tr>
                <th>Fecha</th>
                <th>Equipo</th>
                <th>Cliente</th>
                <th>Sucursal</th>
                <th>Contador Impresiones</th>
                <th>Contador Escaneos</th>
                <th>Técnico</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for conteo in conteos %}
            <tr>
                <td>{{ conteo.fecha_conteo.strftime('%d/%m/%Y %H:%M') }}</td>
                <td>
                    {{ conteo.equipo.nombre }}
                    <small class="d-block text-muted">{{ conteo.equipo.marca }} {{ conteo.equipo.modelo }}</small>
                    {% if conteo.equipo.numero_serie %}
                    <small class="d-block text-muted">S/N: {{ conteo.equipo.numero_serie }}</small>
                    {% endif %}
                </td>
                <td>{{ conteo.equipo.cliente.nombre if conteo.equipo.cliente else 'N/A' }}</td>
                <td>{{ conteo.equipo.sucursal.nombre if conteo.equipo.sucursal else 'N/A' }}</td>
                <td>
                    {{ "{:,}".format(conteo.contador_impresiones) }}
                    {% if conteo.impresiones_desde_ultimo %}
                        <span class="badge bg-{{ 'success' if conteo.impresiones_desde_ultimo > 0 else 'secondary' }}" 
                              data-bs-toggle="tooltip" 
                              title="Desde último conteo: {{ conteo.impresiones_desde_ultimo }}">
                            {{ '+' if conteo.impresiones_desde_ultimo > 0 }}{{ conteo.impresiones_desde_ultimo }}
                        </span>
                    {% endif %}
                </td>
                <td>
                    {{ "{:,}".format(conteo.contador_escaneos) }}
                    {% if conteo.escaneos_desde_ultimo %}
                        <span class="badge bg-{{ 'success' if conteo.escaneos_desde_ultimo > 0 else 'secondary' }}" 
                              data-bs-toggle="tooltip" 
                              title="Desde último conteo: {{ conteo.escaneos_desde_ultimo }}">
                            {{ '+' if conteo.escaneos_desde_ultimo > 0 }}{{ conteo.escaneos_desde_ultimo }}
                        </span>
                    {% endif %}
                </td>
                <td>{{ conteo.tecnico.nombre }}</td>
                <td>
                    <div class="btn-group" role="group">
                        <a href="{{ url_for('conteos.detalle', id=conteo.id) }}" class="btn btn-sm btn-info" title="Ver detalles">
                            <i class="fas fa-eye"></i>
                        </a>
                        <a href="#" 
                           class="btn btn-sm btn-warning" 
                           data-bs-toggle="tooltip" 
                           title="Editar">
                            <i class="fas fa-edit"></i>
                        </a>
                        {% if conteo.requiere_mantenimiento %}
                        <span class="badge bg-danger ms-1" data-bs-toggle="tooltip" title="Requiere mantenimiento">
                            <i class="fas fa-tools"></i>
                        </span>
                        {% endif %}
                    </div>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="8" class="text-center text-muted py-4">
                    <i class="fas fa-inbox fa-3x mb-3"></i>
                    <p class="mb-0">No hay registros de conteo de impresiones</p>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
// Inicializar tooltips
$(document).ready(function() {
    // Inicializar DataTable
    $('#dataTable').DataTable({
        responsive: true,
        order: [[0, 'desc']], // Ordenar por fecha descendente por defecto
        language: {
            url: '//cdn.datatables.net/plug-ins/1.10.25/i18n/Spanish.json'
        },
        dom: "<'row'<'col-sm-12 col-md-6'l><'col-sm-12 col-md-6'f>>" +
             "<'row'<'col-sm-12'tr>>" +
             "<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>",
        pageLength: 25
    });
    
    // Inicializar tooltips de Bootstrap
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
});
</script>
{% endblock %}
